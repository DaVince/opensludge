<html>
<head>
<TITLE>Problems with +=, -=, *=, /= and %= in SLUDGE</TITLE>
</head>
<BODY bgcolor=#FFFFFF TEXT=#000000 LINK=#228822 VLINK=#228822 ALINK=#33BB33>
<CENTER><HR COLOR=#000000 VSPACE=1 NOSHADE SIZE=2>
<TABLE WIDTH=292 BORDER=0 CELLPADDING=0 CELLSPACING=0><TR><TD VALIGN=bottom ALIGN=center height=80 width=292 background="images/sludgepale.gif"><FONT FACE=arial color=#DD0000 SIZE=+1><B>Problems with +=, -=, *=, /= and %= in SLUDGE</B><BR></FONT></TABLE><HR COLOR=#000000 VSPACE=1 NOSHADE SIZE=2>
</center><IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=15><BR>
The above operations should not be performed on elements of a stack which are obtained using square brackets containing an index which is the result of code which may change one or more values (such as a function call or, ++ or --). The reason for this is that any code used to determine the index value will be performed twice. That is to say, this is safe...<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>a /= 7;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
This is safe...<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>someStack[20] += &quot;... or so it would seem.&quot;;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
This is safe...<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>anotherStack[4 * h + 2 - i] %= blah[r ++];</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
But this isn't.<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>strangeResults[someSub ()] *= 2;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
The reason for this is that these lines are partially expanded by the compiler before being compiled. The best way to think of this is that the first three examples are treated as...<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>a = a / 7;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>someStack[20] = someStack[20] + &quot;... or so it would seem.&quot;;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>anotherStack[4 * h + 2 - i] = anotherStack[4 * h + 2 - i] % blah[r ++];</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
Therefore, the fourth example is treated as...<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<FONT color=#BB4444><TT><B>strangeResults[someSub ()] = strangeResults[someSub ()] * 2;</B></TT></FONT><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
As you can see, the index part will be executed more than once. However don't assume your program will be compiled this way... future releases of the SLUDGE compiler may well fix the problem.<BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=15><BR>
<FONT FACE=arial color=#3A8F8B SIZE=+1><B>See also:</B></FONT><BR>

<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=13><BR>
<b><a href="Variable_Operations.html">Variable Operations</a></b><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<b><a href="The_Multi-Purpose_Stack___Array___Queue_Type.html">The Multi-Purpose Stack / Array / Queue Type</a></b><BR>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<B><FONT SIZE=1>SLUDGE and this SLUDGE documentation are <A HREF="Copyright.html">copyright</A> Hungry Software 2000-2006</FONT></B>
<IMG SRC="images/blank.gif" WIDTH=1 HEIGHT=10><BR>
<HR COLOR=#000000 VSPACE=1 NOSHADE SIZE=2>
</BODY>
</html>
